<!-- requestDetail.html -->
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>調査依頼 詳細</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <style>
      .page-title {
        letter-spacing: 0.04em;
      }
      .card {
        border: 0;
      }
      .section-title {
        font-weight: 600;
      }
      .kv {
        display: grid;
        grid-template-columns: 12rem 1fr;
        gap: 0.5rem 1rem;
      }
      .kv dt {
        color: var(--bs-secondary-color);
      }
      .kv dd {
        margin: 0;
      }
      .badge-entity {
        font-weight: 600;
        background: #eef2f5;
        color: #6c757d;
        border: 1px solid #cfd6dc;
      }
      .badge-entity.FG {
        background: #e7f1ff;
        color: #0d6efd;
        border-color: #b6d2ff;
      }
      .badge-entity.BK {
        background: #fef3e6;
        color: #fd7e14;
        border-color: #ffd7a8;
      }
      .badge-entity.OTB {
        background: #eaf7ef;
        color: #198754;
        border-color: #bfe6cd;
      }
      .badge-entity.SC {
        background: #f1e8ff;
        color: #6f42c1;
        border-color: #d7c6ff;
      }
      .badge-entity.TB {
        background: #fff3f4;
        color: #d63384;
        border-color: #ffc2cf;
      }
      .badge-soft {
        background: var(--bs-secondary-bg);
        border: 1px solid var(--bs-secondary-border-subtle);
      }
      .stepper {
        display: flex;
        gap: 1.25rem;
        flex-wrap: wrap;
      }
      .stepper .step {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--bs-secondary-color);
      }
      .stepper .step i {
        width: 1.5rem;
        height: 1.5rem;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: 1px solid var(--bs-secondary-border-subtle);
        background: var(--bs-secondary-bg);
      }
      .stepper .step.active {
        color: var(--bs-body-color);
      }
      .stepper .step.active i {
        border-color: rgba(var(--bs-primary-rgb), 0.45);
        background: rgba(var(--bs-primary-rgb), 0.12);
        color: var(--bs-primary);
      }
      .table-sm td,
      .table-sm th {
        padding: 0.5rem 0.75rem;
      }
      .muted {
        color: var(--bs-secondary-color);
      }
      .timeline {
        list-style: none;
        padding-left: 0;
        margin: 0;
      }
      .timeline li {
        position: relative;
        padding-left: 1.5rem;
        margin: 0.5rem 0;
      }
      .timeline li::before {
        content: "";
        position: absolute;
        left: 0.5rem;
        top: 0.35rem;
        width: 0.5rem;
        height: 0.5rem;
        border-radius: 50%;
        background: var(--bs-primary);
      }
      .divider {
        height: 1px;
        background: var(--bs-border-color);
        opacity: 0.6;
        margin: 1rem 0;
      }
      .btn-icon {
        width: 2.25rem;
        height: 2.25rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      @media (max-width: 768px) {
        .kv {
          grid-template-columns: 8rem 1fr;
        }
      }
    </style>
  </head>
  <body class="bg-body-tertiary">
    <main class="container py-4">
      <!-- ヘッダーバー -->
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="d-flex align-items-center">
          <i class="bi bi-file-earmark-text fs-3 me-2 text-primary"></i>
          <h1 class="h4 page-title mb-0">調査依頼 詳細</h1>
        </div>
        <div class="d-flex gap-2">
          <a class="btn btn-outline-secondary"
            ><i class="bi bi-arrow-left"></i> 一覧へ</a
          >
        </div>
      </div>

      <!-- 概要カード -->
      <div class="card shadow-sm mb-3">
        <div class="card-body">
          <div class="row g-3">
            <div class="col-lg-7">
              <div class="kv">
                <dt>依頼No.</dt>
                <dd class="fw-semibold">1234</dd>
                <dt>応募者 / 対象者</dt>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- コンテンツ：各工程 -->
      <form>
        <div class="row g-3">
          <!-- 同意書（表示のみ） -->
          <div class="col-12">
            <div class="card shadow-sm">
              <div class="card-body">
                <div class="section-title mb-2">
                  <i class="bi bi-file-check"></i> 同意書
                </div>
                <dl class="kv">
                  <dt>本人へ</dt>
                  <dd>9月1日</dd>
                  <dt>取得</dt>
                  <dd>9月2日</dd>
                </dl>
              </div>
            </div>
          </div>

          <!-- データチェック（編集可） -->
          <div class="col-12 col-lg-6">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <div class="section-title mb-2">
                  <i class="bi bi-clipboard-check"></i> データチェック
                </div>
                <div class="row g-3">
                  <div class="col-6">
                    <label class="form-label">依頼</label>
                    <div class="d-flex align-items-center gap-2">
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" />
                        <label class="form-check-label"></label>
                      </div>
                      <input type="date" class="form-control" />
                    </div>
                  </div>
                  <div class="col-6">
                    <label class="form-label">完了</label>
                    <div class="d-flex align-items-center gap-2">
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" />
                        <label class="form-check-label"></label>
                      </div>
                      <input type="date" class="form-control" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- バックグラウンドチェック（編集可） -->
          <div class="col-12 col-lg-6">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <div class="section-title mb-2">
                  <i class="bi bi-search"></i> バックグラウンドチェック
                </div>
                <div class="row g-3">
                  <div class="col-12 col-md-4">
                    <label class="form-label">依頼</label>
                    <div class="d-flex align-items-center gap-2">
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" />
                      </div>
                      <input type="date" class="form-control" />
                    </div>
                  </div>
                  <div class="col-12 col-md-4">
                    <label class="form-label">調査開始</label>
                    <div class="d-flex align-items-center gap-2">
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" />
                      </div>
                      <input type="date" class="form-control" />
                    </div>
                  </div>
                  <div class="col-12 col-md-4">
                    <label class="form-label">完了</label>
                    <div class="d-flex align-items-center gap-2">
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" />
                      </div>
                      <input type="date" class="form-control" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 現職の詳細確認（編集可） -->
          <div class="col-12 col-lg-6">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <div class="section-title mb-2">
                  <i class="bi bi-building"></i> 現職の詳細確認
                </div>
                <div class="row g-3">
                  <div class="col-md-4">
                    <label class="form-label">開始</label>
                    <input type="date" class="form-control" />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">ご本人了承</label>
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" />
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">完了</label>
                    <input type="date" class="form-control" />
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- リファレンスインタビュー（編集可：行追加/削除） -->
          <div class="col-12">
            <div class="card shadow-sm">
              <div class="card-body">
                <div
                  class="d-flex align-items-center justify-content-between mb-2"
                >
                  <div class="section-title">
                    <i class="bi bi-people"></i> リファレンスインタビュー
                  </div>
                  <div>
                    <div
                      class="form-check form-switch d-inline-flex align-items-center me-2"
                    >
                      <div class="d-flex align-items-end gap-4">
                        <!-- 依頼済み -->
                        <div>
                          <label class="form-label">依頼済み</label>
                          <div class="d-flex align-items-center gap-5">
                            <div class="form-check form-switch mb-0">
                              <input class="form-check-input" type="checkbox" />
                            </div>
                            <input
                              type="date"
                              class="form-control"
                              style="width: auto"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="table-responsive">
                  <table class="table table-sm align-middle">
                    <thead class="text-secondary">
                      <tr>
                        <th style="width: 3rem">No</th>
                        <th>回答者</th>
                        <th style="width: 18rem">日付</th>
                        <th style="width: 18rem">完了</th>
                        <th style="width: 3rem"></th>
                      </tr>
                    </thead>
                    <tbody id="refBody">
                      <tr>
                        <td>1</td>
                        <td>
                          <input type="text" class="form-control" />
                        </td>
                        <td>
                          <input type="date" class="form-control" />
                        </td>
                        <td>
                          <div class="d-flex align-items-center gap-2">
                            <div class="form-check form-switch">
                              <input class="form-check-input" type="checkbox" />
                            </div>
                            <input type="date" class="form-control" />
                          </div>
                        </td>
                        <td class="text-end">
                          <button
                            type="button"
                            class="btn btn-outline-danger btn-sm remove-ref"
                          >
                            <i class="bi bi-trash"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td colspan="5" class="text-secondary">
                          行はありません。「追加」を押して下さい。
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <button
                  type="button"
                  class="btn btn-outline-primary"
                  id="addRef"
                >
                  <i class="bi bi-plus-lg"></i> 追加
                </button>
              </div>
            </div>
          </div>

          <!-- 個別連絡 / 依頼辞退（編集可） -->
          <div class="col-12 col-lg-6">
            <div class="card shadow-sm mb-3">
              <div class="card-body">
                <div class="section-title mb-2">
                  <i class="bi bi-chat-left-text"></i> 個別連絡
                </div>
                <div class="row g-3">
                  <div class="col-md-4">
                    <label class="form-label">要否</label>
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" />
                    </div>
                  </div>
                  <div class="col-md-8">
                    <label class="form-label">メモ</label>
                    <input type="text" class="form-control" />
                  </div>
                </div>
              </div>
            </div>

            <div class="card shadow-sm">
              <div class="card-body">
                <div class="section-title mb-2">
                  <i class="bi bi-slash-circle"></i> 依頼辞退
                </div>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">状況</label>
                    <select class="form-select">
                      <option value="">―</option>
                      <option>保留</option>
                      <option>中止</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">日付</label>
                    <input type="date" class="form-control" />
                  </div>
                  <div class="col-12">
                    <label class="form-label">理由</label>
                    <textarea class="form-control" rows="2"></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 右下：添付/履歴（表示のみ）→そのまま -->
          <!-- ・・・必要なら前回の表示カードを残してください・・・ -->
        </div>

        <!-- フッタ操作（保存） -->
        <div class="d-flex justify-content-between mt-3">
          <a class="btn btn-outline-secondary"
            ><i class="bi bi-arrow-left"></i> 一覧へ戻る</a
          >
          <div class="d-flex gap-2">
            <button type="reset" class="btn btn-outline-secondary">
              リセット
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="bi bi-save"></i> 保存
            </button>
          </div>
        </div>
      </form>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      (function () {
        const body = document.getElementById("refBody");
        const addBtn = document.getElementById("addRef");
        if (!body || !addBtn) return;

        // 名前付き index の最大を取得
        const nextIndex = () => {
          const rows = body.querySelectorAll("tr");
          let max = -1;
          rows.forEach((r) => {
            const inputs = r.querySelectorAll("input,select,textarea");
            inputs.forEach((i) => {
              const m = (i.getAttribute("name") || "").match(
                /references\[(\d+)\]/
              );
              if (m) max = Math.max(max, parseInt(m[1], 10));
            });
          });
          return max + 1;
        };

        addBtn.addEventListener("click", () => {
          const i = nextIndex();
          const tr = document.createElement("tr");
          tr.innerHTML = `
        <td>${i + 1}</td>
        <td><input type="text" class="form-control" name="references[${i}].name"></td>
        <td><input type="date" class="form-control" name="references[${i}].date"></td>
        <td>
          <div class="d-flex align-items-center gap-2">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" name="references[${i}].done">
            </div>
            <input type="date" class="form-control" name="references[${i}].doneAt">
          </div>
        </td>
        <td class="text-end">
          <button type="button" class="btn btn-outline-danger btn-sm remove-ref">
            <i class="bi bi-trash"></i>
          </button>
        </td>
      `;
          body.appendChild(tr);
        });

        body.addEventListener("click", (e) => {
          if (e.target.closest(".remove-ref")) {
            const tr = e.target.closest("tr");
            tr?.remove();
            // 連番を振り直す（見た目だけ）
            body.querySelectorAll("tr").forEach((r, idx) => {
              const cell = r.querySelector("td:first-child");
              if (cell) cell.textContent = idx + 1;
            });
          }
        });
      })();
    </script>
  </body>
</html>
